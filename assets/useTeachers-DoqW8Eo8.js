import{r as o}from"./router-DwwGQyGz.js";import{q as y,c as l,o as m,g as u,a as R,s as f,d as T,u as $,w as g,b as E,e as x}from"./firebase-Bm0Jh8Cr.js";import{d}from"./config-CjFVmyQa.js";const B=async t=>{try{return(await R(l(d,"teachers"),{...t,createdAt:f(),updatedAt:f()})).id}catch(e){throw console.error("Error adding teacher:",e),e}},P=async()=>{try{const t=y(l(d,"teachers"),m("fullname","asc"));return(await u(t)).docs.map(a=>({id:a.id,...a.data()}))}catch(t){throw console.error("Error getting teachers:",t),t}},H=async()=>{try{const t=y(l(d,"teachers"),m("fullname","asc"));return(await u(t)).docs.map(a=>({id:a.id,...a.data()}))}catch(t){throw console.error("Error getting teachers:",t),t}},J=async t=>{try{const e=T(d,"teachers",t),a=await x(e);if(a.exists())return{id:a.id,...a.data()};throw new Error("Teacher not found")}catch(e){throw console.error("Error getting teacher by ID:",e),e}},v=async(t,e)=>{try{const a=T(d,"teachers",t);return await $(a,{...e,updatedAt:f()}),!0}catch(a){throw console.error("Error updating teacher:",a),a}},L=async t=>{try{const e=y(l(d,"attendance"),g("teacherId","==",t)),n=(await u(e)).docs.map(p=>E(p.ref));return await Promise.all(n),await E(T(d,"teachers",t)),!0}catch(e){throw console.error("Error deleting teacher:",e),e}},Q=async t=>{try{const e=y(l(d,"teachers"),g("fullname",">=",t),g("fullname","<=",t+"ï£¿"),m("fullname","asc"));return(await u(e)).docs.map(n=>({id:n.id,...n.data()}))}catch(e){throw console.error("Error searching teachers:",e),e}},j=async()=>{try{const e=(await u(l(d,"teachers"))).docs.map(n=>n.data()),a=[...new Set(e.map(n=>n.department))];return{totalTeachers:e.length,totalDepartments:a.length}}catch(t){throw console.error("Error getting teacher statistics:",t),t}},K=()=>{const[t,e]=o.useState([]),[a,n]=o.useState(!1),[p,S]=o.useState(null),[b,q]=o.useState({totalTeachers:0,totalDepartments:0}),c=o.useCallback(async r=>{n(!0),S(null);try{return await r()}catch(s){return console.error("Database operation error:",s),S(s.message||"An error occurred"),null}finally{n(!1)}},[]),h=o.useCallback(async()=>{const r=await c(P);r&&e(r)},[c]),D=o.useCallback(async r=>{const s=await c(()=>B(r));return s&&await h(),s},[c,h]),k=o.useCallback(async(r,s)=>{const i=await c(()=>v(r,s));return i&&await h(),i},[c,h]),C=o.useCallback(async r=>{const s=await c(()=>L(r));return s&&e(i=>i.filter(I=>I.id!==r)),s},[c]),A=o.useCallback(async r=>{if(!r.trim()){await h();return}const s=await c(()=>Q(r));s&&e(s)},[c,h]),w=o.useCallback(async()=>{const r=await c(j);r&&q(r)},[c]);return o.useEffect(()=>{h(),w()},[h,w]),{teachers:t,loading:a,error:p,stats:b,fetchTeachers:h,addTeacher:D,updateTeacher:k,deleteTeacher:C,searchTeachers:A,fetchTeacherStats:w}};export{H as a,J as g,K as u};
